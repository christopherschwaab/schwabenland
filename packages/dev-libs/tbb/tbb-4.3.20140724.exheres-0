# Copyright 2014 Christopher Schwaab
# Distributed under the terms of the GNU General Public License v2

_TBB_NAME="tbb$(ever delete_all $(ever range 1-2 $PV))_$(ever range 3 $PV)oss"

SUMMARY="A C++ template library simplifying the development of applications running in parallel."
HOMEPAGE="https://www.threadingbuildingblocks.org/"
DOWNLOADS="https://www.threadingbuildingblocks.org/sites/default/files/software_releases/source/${_TBB_NAME}_src.tgz"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~x86 ~amd64"
MYOPTIONS="
    examples [[ description = [ Build examples. ] ]]
"

BUGS_TO="christopher.schwaab@gmail.com"
WORK="$WORKBASE/$_TBB_NAME"

src_compile() {
    # FIXME examples
    emake tbb tbbmalloc
}

src_install() {
    find build -name 'lib*.so.*' -exec dolib.so {} \;
    find build -name 'lib*.so' -exec dolib {} \;
    insinto /usr/include
    doins -r include/{serial,tbb}
    # FIXME documentation and examples?
}

# FIXME tests don't seem to exit on failure?
